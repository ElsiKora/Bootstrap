import { unstable_TSDoc as TSDoc } from 'nextra/tsdoc'

# Registry Pattern

The `Registry` pattern, implemented by `IRegistry` and `BaseRegistry`, provides a way to store and retrieve objects or configuration templates using a unique [`Symbol`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol) as the key.
It's often used as the data source for a [Factory](/docs/cladi/core-concepts/factory).

Imagine needing different sets of configuration for different environments (dev, staging, prod) or different types of resources (small server, large server). A Registry is ideal for managing these named variations using symbolic keys.

## Key Features & Examples

- **Registration (`register`/`registerMany`)**: Store items using a unique `Symbol`.

  ```typescript filename="src/config-registry.ts" copy
  import { createRegistry, type IRegistry } from '@elsikora/cladi';

  // Define the structure of our configuration objects
  interface ServerConfig {
    // No mandatory 'name: string' key needed, the symbol is the key
    cpu: number;
    memory: string;
    storage: string;
    region: 'us-east-1' | 'eu-west-1';
  }

  // Define unique symbols for keys
  const ConfigKeys = {
    StandardDev: Symbol.for("standard-dev"),
    HighMemProd: Symbol.for("high-mem-prod"),
    NonExistent: Symbol.for("non-existent"), // For examples
  };

  const registry: IRegistry<ServerConfig> = createRegistry<ServerConfig>({}); // Logger can be passed in options

  // Register different server configurations using symbols
  registry.register(ConfigKeys.StandardDev, {
    cpu: 2,
    memory: "4Gi",
    storage: "50Gi",
    region: "us-east-1",
  });

  registry.register(ConfigKeys.HighMemProd, {
    cpu: 8,
    memory: "32Gi",
    storage: "500Gi",
    region: "eu-west-1",
  });

  console.log(`Registry contains 'standard-dev': ${registry.has(ConfigKeys.StandardDev)}`); // true
  ```

- **Retrieval (`get`/`getMany`/`getAll`)**: Fetch items by their registered `Symbol`(s). `getAll` retrieves all registered items (values only, not keys).

  ```typescript filename="src/retrieve-configs.ts" copy
  // Assuming registry and ConfigKeys from previous example
  declare const registry: IRegistry<ServerConfig>;
  declare const ConfigKeys: { StandardDev: symbol; HighMemProd: symbol; NonExistent: symbol; };

  const devConfig = registry.get(ConfigKeys.StandardDev);
  console.log(`Dev CPU: ${devConfig?.cpu}`); // 2

  const prodConfig = registry.get(ConfigKeys.HighMemProd);
  console.log(`Prod Memory: ${prodConfig?.memory}`); // "32Gi"

  const allConfigs = registry.getAll();
  console.log(`Total configs registered: ${allConfigs.length}`); // 2

  const specificConfigs = registry.getMany([ConfigKeys.StandardDev, ConfigKeys.NonExistent]);
  console.log(`Found specific configs: ${specificConfigs.length}`); // 1 (only standard-dev)
  ```

- **Checking Existence (`has`)**: Quickly check if a `Symbol` key is registered without retrieving the object.
  ```typescript filename="src/check-config.ts" copy
  declare const registry: IRegistry<ServerConfig>;
  declare const ConfigKeys: { StandardDev: symbol; HighMemProd: symbol; };
  if (registry.has(ConfigKeys.HighMemProd)) {
    console.log("Production configuration is available.");
  }
  ```

- **Unregistration (`unregister`/`unregisterMany`)**: Remove items by `Symbol` key.
  ```typescript filename="src/unregister-config.ts" copy
  declare const registry: IRegistry<ServerConfig>;
  declare const ConfigKeys: { StandardDev: symbol; HighMemProd: symbol; };
  registry.unregister(ConfigKeys.StandardDev);
  console.log(`Registry contains 'standard-dev' after unregister: ${registry.has(ConfigKeys.StandardDev)}`); // false
  ```

- **Clearing (`clear`)**: Empty the entire registry.
  ```typescript filename="src/clear-registry.ts" copy
  registry.clear();
  console.log(`Total configs after clear: ${registry.getAll().length}`); // 0
  ```

- **Caching (Internal)**: The `BaseRegistry` implementation automatically caches the results of `getAll` and `getMany` calls. Subsequent identical calls return the cached result for performance. The cache is automatically cleared whenever `register`, `registerMany`, `unregister`, `unregisterMany`, or `clear` is called.

## Purpose & Use Cases

- **Managing Variations**: Store different versions or configurations of an object (e.g., environment settings, feature flag states, UI themes, resource definitions) identified by unique symbols.
- **Decoupling Definitions**: Separates the *definition* of these variations from the code that *uses* them.
- **Data Source for Factories**: Provide the symbol-keyed templates that a [Factory](/docs/cladi/core-concepts/factory) will use to create actual instances.

## Core Implementation

- **`IRegistry<T>` (Interface)**: Located in `src/domain/interface/registry.interface.ts`. Defines the contract using `Symbol` keys.
- **`BaseRegistry<T>` (Class)**: Located in `src/infrastructure/class/base/registry.class.ts`. The default implementation, featuring internal caching and optional logging. It uses `String(symbol)` internally for map keys but exposes the `Symbol`-based interface.
- **`createRegistry<T>` (Utility)**: Exported from the library root. A convenient function to instantiate `BaseRegistry`, accepting `IBaseRegistryOptions` (primarily for passing a logger).

### Base Implementation Options (`IBaseRegistryOptions`)

<TSDoc code={`import type { IBaseRegistryOptions } from '@elsikora/cladi';
export default IBaseRegistryOptions`} /> 
